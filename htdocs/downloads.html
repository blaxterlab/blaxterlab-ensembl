<html>
<head>
<title>LepBase: Downloads</title>
</head>
<body>
<script type="text/javascript" src="/components/00_jquery.min.js"></script>
<script type="text/javascript" src="/components/00_jquery_ui.min.js"></script>
<script type="text/javascript" src="/downloads.js"></script>
<style>
  a { cursor:pointer; }
  thead { font-weight: bold; }
</style>
<script>
           

function getReadableFileSizeString(fileSizeInBytes) {
//http://stackoverflow.com/questions/10420352/converting-file-size-in-bytes-to-human-readable
    var i = -1;
    var byteUnits = [' kB', ' MB', ' GB', ' TB', 'PB', 'EB', 'ZB', 'YB'];
    do {
        fileSizeInBytes = fileSizeInBytes / 1024;
        i++;
    } while (fileSizeInBytes > 1024);

    return Math.max(fileSizeInBytes, 0.1).toFixed(1) + byteUnits[i];
};

var rows = {};
files.forEach(function(d,index,array){
	var parts = d.file.split('_-_');
    var type = parts[1].replace(/\..+/,'');
    if (!rows[parts[0]]){
    	rows[parts[0]] = {};
    }
    rows[parts[0]][type] = {};
    rows[parts[0]][type].file = d.file;
    rows[parts[0]][type].size = getReadableFileSizeString(d.size);
    
  });
  

$(document).ready(function(){
      var table = $('#tbody');
      var ctr = 0;
      $.each(rows,function(id,d){
      	ctr++;
      	var css = ctr%2 == 0 ? 'class="bg2"' : '';
      	table.append('<tr '+css+' id="'+id+'"><td>' + id.replace(/_/g,' ') + '</td></tr>');
      	var tr = $('#'+id);
      	$('#tbody > tr:last-child').append('<td>' + (rows[id].scaffolds ? '<a class="download-link" rel="'+rows[id].scaffolds.file+'">' + rows[id].scaffolds.size : ''));
      	$('#tbody > tr:last-child').append('<td>' + (rows[id].cds ? '<a class="download-link" rel="'+rows[id].cds.file+'">' + rows[id].cds.size : ''));
      	$('#tbody > tr:last-child').append('<td>' + (rows[id].proteins ? '<a class="download-link" rel="'+rows[id].proteins.file+'">' + rows[id].proteins.size : ''));
      	$('#tbody > tr:last-child').append('<td>' + (rows[id].gff ? '<a class="download-link" rel="'+rows[id].gff.file+'">' + rows[id].gff.size : ''));
      });
      $('.download-link').on('click',function(){
      	console.log($(this).parent().parent().attr("id"));
      	console.log($(this).attr("rel"));
      	//parent.attr("id"));
      });
    });
</script>

<div id="static">



<h2>Bulk data downloads</h2>
<table class="ss tint">
  <thead>
    <tr class="bg2">
      <td rowspan="1">Species/Assembly</td>
      <td>Scaffold</td>
      <td>CDS</td>
      <td>Protein</td>
      <td rowspan="1">GFF</td>
    </tr>
    
  </thead>
  <tfoot>
  </tfoot>
  <tbody id="tbody">
  </tbody>
</table>



</div>

</body>
</html>
